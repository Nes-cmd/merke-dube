import{u as U,r as n,j as e,Y as w,$ as D,e as Y}from"./app-J7HsqsI9.js";import{S as u,A as Z,a as I}from"./AuthenticatedLayout-knoU74ve.js";import{F as p}from"./index-BqbYBDii.js";import{A as G}from"./index-DztLhxX3.js";import{R as K}from"./FileImageOutlined-2IqvSZ2M.js";import{T as H}from"./index-BE7oq81o.js";import{B as k}from"./index-Tnbu6Yrc.js";import{T as J}from"./index-Dz6IsBsV.js";import{T as C,B as l}from"./EllipsisOutlined-z3H18_gv.js";import{R as X}from"./EditOutlined-DKX5yRBc.js";import{R as ee}from"./ReloadOutlined-Cw7nNdxE.js";import{R as te,T as _}from"./index-DY6NS2TT.js";import{F as re}from"./Table-C7mTbJGI.js";import{M as se}from"./index-DcVtvz2k.js";import{T as R}from"./index-BzvObz3P.js";import{R as q}from"./SearchOutlined-BswwKShY.js";import{I as ie}from"./index-B4GooqbK.js";import{s as c,S as oe}from"./index-DifNHl01.js";/* empty css            */import"./MenuOutlined-CPzlee0P.js";import"./move-C0wxGgXZ.js";import"./row-CrguNsy7.js";import"./index-BPj3NJfq.js";import"./BaseInput-CPkyeE5i.js";import"./index-BwMG-dte.js";import"./styleChecker-Ds4zr2-F.js";import"./addEventListener-BJOWCriI.js";import"./DownOutlined-DYFiL0VQ.js";import"./index-DmrLIlKl.js";import"./index-CUWDS_la.js";import"./EyeOutlined-DkxJknix.js";const{Option:Ee}=oe,{Text:T}=H,{TabPane:F}=_,Me=({auth:z,inventory:j,shops:g})=>{const{t:s}=U(),[ae,v]=n.useState(""),[P,A]=n.useState(""),[h,N]=n.useState("all"),S=n.useRef(null),[$,x]=n.useState(!1),[a,B]=n.useState(null),[f]=p.useForm(),[E,y]=n.useState(!1),M=h==="all"?j:j.filter(t=>t.shop_id===parseInt(h)),b=(t,r,i)=>{r(),v(t[0]),A(i)},W=t=>{t(),v("")},L=t=>{B(t),f.setFieldsValue({quantity:1,max_available:t.item.quantity}),x(!0)},O=async()=>{try{y(!0);const t=await f.validateFields();if(t.quantity>a.item.quantity){c.error(s("Cannot refill more than available warehouse quantity")),y(!1);return}const r=await Y.post(route("inventory.refill",a.id),{quantity:t.quantity});c.success(s("Inventory refilled successfully")),x(!1),window.location.reload()}catch(t){t.response?c.error(t.response.data.message||s("Failed to refill inventory")):t.errorFields?c.error(s("Please check the form fields")):c.error(s("An error occurred"))}finally{y(!1)}},Q=t=>({filterDropdown:({setSelectedKeys:r,selectedKeys:i,confirm:o,clearFilters:m})=>e.jsxs("div",{style:{padding:8},children:[e.jsx(ie,{ref:S,placeholder:`${s("Search")} ${s(t)}`,value:i[0],onChange:d=>r(d.target.value?[d.target.value]:[]),onPressEnter:()=>b(i,o,t),style:{width:188,marginBottom:8,display:"block"}}),e.jsxs(u,{children:[e.jsx(l,{type:"primary",onClick:()=>b(i,o,t),icon:e.jsx(q,{}),size:"small",style:{width:90},children:s("Search")}),e.jsx(l,{onClick:()=>W(m),size:"small",style:{width:90},children:s("Reset")})]})]}),filterIcon:r=>e.jsx(q,{style:{color:r?"#1890ff":void 0}}),onFilter:(r,i)=>i[t]?i[t].toString().toLowerCase().includes(r.toLowerCase()):"",onFilterDropdownVisibleChange:r=>{r&&setTimeout(()=>{var i;return(i=S.current)==null?void 0:i.select()},100)},render:r=>P===t?e.jsx("span",{style:{fontWeight:"bold"},children:r}):r}),V=[{title:s("Image"),key:"image",width:80,render:(t,r)=>{var o,m;const i=((o=r.item.images)==null?void 0:o.find(d=>d.is_primary))||((m=r.item.images)==null?void 0:m[0]);return e.jsx(G,{shape:"square",size:64,src:i?`/storage/${i.image_path}`:null,icon:!i&&e.jsx(K,{})})}},{title:s("Product"),key:"product",...Q("item.name"),render:(t,r)=>e.jsxs(u,{direction:"vertical",size:0,children:[e.jsx(T,{strong:!0,children:r.item.name}),r.item.sku&&e.jsxs(T,{type:"secondary",style:{fontSize:"12px"},children:["SKU: ",r.item.sku]})]})},{title:s("Shop"),key:"shop",render:(t,r)=>r.shop.name,filters:g.map(t=>({text:t.name,value:t.id})),onFilter:(t,r)=>r.shop_id===t},{title:s("Category"),key:"category",render:(t,r)=>r.item.category?r.item.category.name:s("Uncategorized")},{title:s("Shop Quantity"),dataIndex:"quantity",key:"quantity",sorter:(t,r)=>t.quantity-r.quantity,render:(t,r)=>{let i="green",o=s("In Stock");return t<=0?(i="red",o=s("Out of Stock")):t<=5&&(i="orange",o=s("Low Stock")),e.jsxs(u,{direction:"vertical",size:0,children:[e.jsx(k,{count:t,showZero:!0,overflowCount:9999,style:{backgroundColor:i==="red"?"#f5222d":i==="orange"?"#fa8c16":"#52c41a",fontSize:"14px",padding:"0 8px"}}),e.jsx(J,{color:i,style:{marginTop:"4px"},children:o})]})}},{title:s("Warehouse Stock"),key:"warehouseQty",render:(t,r)=>e.jsx(k,{count:r.item.quantity,showZero:!0,overflowCount:9999,style:{backgroundColor:r.item.quantity>0?"#52c41a":"#f5222d",fontSize:"14px",padding:"0 8px"}})},{title:s("Unit Price"),key:"price",render:(t,r)=>`ETB ${(parseFloat(r.item.unit_price)||0).toFixed(2)}`,sorter:(t,r)=>{const i=parseFloat(t.item.unit_price)||0,o=parseFloat(r.item.unit_price)||0;return i-o}},{title:s("Actions"),key:"action",width:150,fixed:"right",render:(t,r)=>e.jsxs(u,{size:"small",children:[e.jsx(C,{title:s("Edit Inventory"),children:e.jsx(w,{href:route("inventory.edit",r.id),children:e.jsx(l,{icon:e.jsx(X,{}),size:"small"})})}),e.jsx(C,{title:s("Refill from Warehouse"),children:e.jsx(l,{icon:e.jsx(ee,{}),size:"small",disabled:r.item.quantity<=0,onClick:()=>L(r)})})]})}];return e.jsxs(Z,{user:z.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:s("Shop Inventory")}),children:[e.jsx(D,{title:s("Shop Inventory")}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg p-6",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:s("Inventory by Shop")}),e.jsx(w,{href:route("inventory.create"),children:e.jsx(l,{type:"primary",icon:e.jsx(te,{}),children:s("Add Inventory")})})]}),e.jsx("div",{className:"mb-6 overflow-auto",children:e.jsxs(_,{activeKey:h,onChange:t=>N(t),type:"card",tabPosition:"top",className:"shop-tabs",tabBarGutter:8,children:[e.jsx(F,{tab:e.jsxs("span",{children:[e.jsx(I,{}),s("All Shops")]})},"all"),g.map(t=>e.jsx(F,{tab:e.jsxs("span",{children:[e.jsx(I,{}),t.name]})},t.id))]})}),e.jsx(re,{dataSource:M,columns:V,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,pageSizeOptions:["10","20","50"]},scroll:{x:1200}})]})})}),e.jsx(se,{title:s("Refill Inventory from Warehouse"),open:$,onCancel:()=>x(!1),onOk:O,okText:s("Refill"),okButtonProps:{loading:E},cancelText:s("Cancel"),children:a&&e.jsxs(p,{form:f,layout:"vertical",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("strong",{children:[s("Product"),":"]})," ",a.item.name]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("strong",{children:[s("Current Shop Quantity"),":"]})," ",a.quantity]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("strong",{children:[s("Available in Warehouse"),":"]})," ",a.item.quantity]}),e.jsx(p.Item,{name:"quantity",label:s("Quantity to Add"),rules:[{required:!0,message:s("Please enter quantity")},{validator:(t,r)=>r>a.item.quantity?Promise.reject(s("Cannot refill more than available in warehouse")):Promise.resolve()}],children:e.jsx(R,{min:1,max:a.item.quantity,style:{width:"100%"},placeholder:s("Enter quantity")})}),e.jsx(p.Item,{name:"max_available",hidden:!0,children:e.jsx(R,{})})]})})]})};export{Me as default};
