import{r as l,_ as $,u as ie,v as R,R as le,e as oe,j as e,Y as ne,$ as de}from"./app-BrWmvN9o.js";import{S as ce,A as me}from"./AuthenticatedLayout-BHqB-7Ue.js";import{d as pe}from"./dayjs.min-CkOjI5Qk.js";import{s as d,S as E,E as F}from"./index-D8fjzl8g.js";import{T as xe}from"./index-FVcc8yWs.js";import{I as L,B as c}from"./EllipsisOutlined-BVOabwk_.js";import{R as D}from"./SearchOutlined-DiTr9x9V.js";import{R as ue}from"./DollarOutlined-Bl7DvStB.js";import{R as he,T as O}from"./index-BB7cPWkL.js";import{F as je}from"./Table-DaI8jlKK.js";import{M as z}from"./index-BSgkkuUf.js";import{F as m}from"./index-D7Nbh5W0.js";import{T as I}from"./index-5g0IPodt.js";import{I as T}from"./index-Bj_dR6NL.js";import{C}from"./index-ooL_S3fB.js";import{D as ge}from"./index-4lFyj0Jd.js";import{A as fe}from"./index-Ckg9Niwg.js";import{S as ye}from"./index-D8yoxiRN.js";/* empty css            */import"./MenuOutlined-CfE2IyGz.js";import"./move-D6Noa-TR.js";import"./BaseInput-xYuoHulp.js";import"./DownOutlined-Bl3KEFK6.js";import"./EditOutlined-C1dTsj9U.js";import"./styleChecker-Dv61m2VV.js";import"./addEventListener-DuZlQSgp.js";import"./EyeOutlined-CFoueOds.js";import"./index-BRRz5ppq.js";import"./row-_w8NHETX.js";import"./index-CUWDS_la.js";var ve={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm0 76c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm128.01 198.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-circle",theme:"outlined"},Se=function(u,h){return l.createElement(L,$({},u,{ref:h,icon:ve}))},Ce=l.forwardRef(Se),Ne={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M922.9 701.9H327.4l29.9-60.9 496.8-.9c16.8 0 31.2-12 34.2-28.6l68.8-385.1c1.8-10.1-.9-20.5-7.5-28.4a34.99 34.99 0 00-26.6-12.5l-632-2.1-5.4-25.4c-3.4-16.2-18-28-34.6-28H96.5a35.3 35.3 0 100 70.6h125.9L246 312.8l58.1 281.3-74.8 122.1a34.96 34.96 0 00-3 36.8c6 11.9 18.1 19.4 31.5 19.4h62.8a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7h161.1a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7H923c19.4 0 35.3-15.8 35.3-35.3a35.42 35.42 0 00-35.4-35.2zM305.7 253l575.8 1.9-56.4 315.8-452.3.8L305.7 253zm96.9 612.7c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6zm325.1 0c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6z"}}]},name:"shopping-cart",theme:"outlined"},be=function(u,h){return l.createElement(L,$({},u,{ref:h,icon:Ne}))},M=l.forwardRef(be);const{Option:P}=E,{TabPane:_e}=O,{Text:we}=xe,nt=({auth:N,sales:u,shops:h,customers:Y,flash:j})=>{const{t:a,locale:Fe}=ie(),[V,y]=l.useState(!1),[H,v]=l.useState(!1),[Ie,Te]=l.useState(!1),[p,K]=l.useState(null),[Ee,Be]=l.useState(null),[b,B]=l.useState([]),[n,x]=l.useState([]),[Q,_]=l.useState(!1),[g,k]=l.useState(null),[q,W]=l.useState(""),o=R({credit_payed:"",note:""}),r=R({shop_id:"",customer_id:"",amount_paid:0,note:"",items:[]}),w=n.reduce((t,s)=>t+parseFloat(s.price)*s.quantity,0),S=Math.max(0,w-(r.data.amount_paid||0));le.useEffect(()=>{j.message&&d.success(j.message),j.error&&d.error(j.error)},[j]),l.useEffect(()=>{g&&(_(!0),x([]),oe.get(route("sales.shop-inventory",g)).then(t=>{B(t.data),_(!1)}).catch(t=>{console.error("Error loading shop inventory:",t),d.error(a("Failed to load shop inventory")),_(!1)}))},[g]);const G=(t,s)=>{t.stopPropagation(),K(s),o.reset(),o.setData("credit_payed",s.credit),y(!0)},J=()=>{o.post(route("sales.credit-payed",p.id),{onSuccess:()=>{y(!1)}})},U=()=>{x([]),r.reset(),r.setData("amount_paid",0),k(null),B([]),v(!0)},X=t=>{k(t),r.setData("shop_id",t)},Z=t=>{const s=n.findIndex(i=>i.item_id===t.item_id);if(console.log("Adding to cart:",t),s>=0){const i=[...n];i[s].quantity<t.quantity?(i[s].quantity+=1,x(i)):d.warning(a("Cannot add more of this item (stock limit reached)"))}else x([...n,{item_id:t.item_id,inventory_id:t.id,name:t.item.name,price:parseFloat(t.selling_price||0),quantity:1,max_quantity:t.quantity,inventory:t}])},ee=(t,s)=>{const i=[...n];i[t].quantity=s,x(i)},te=t=>{const s=[...n];s.splice(t,1),x(s)},ae=()=>{if(!r.data.shop_id){d.error(a("Please select a shop"));return}if(n.length===0){d.error(a("Your cart is empty"));return}if(S>0&&!r.data.customer_id){d.error(a("Customer is required for credit sales"));return}const t=n.map(s=>({item_id:s.item_id,inventory_id:s.inventory_id,quantity:s.quantity,price:parseFloat(s.price)}));r.setData({...r.data,items:t}),setTimeout(()=>{console.log("Submitting with data:",r.data),r.post(route("sales.store"),{onSuccess:()=>{d.success(a("Sale completed successfully")),v(!1),x([])},onError:s=>{console.error("Sale submission errors:",s),d.error(s.error||a("Failed to complete sale"))}})},100)},se=()=>{if(Q)return e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(ye,{size:"large"})});if(!g)return e.jsx(F,{description:a("Select a shop to view inventory")});if(!b||b.length===0)return e.jsx(F,{description:a("No inventory items found")});const t=b.filter(s=>{var i,f;return(f=(i=s.item)==null?void 0:i.name)==null?void 0:f.toLowerCase().includes(q.toLowerCase())});return t.length===0?e.jsx(F,{description:a("No items match your search")}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map(s=>{var f,A;const i=parseFloat(s.item.selling_price||0);return e.jsx(C,{size:"small",hoverable:!0,onClick:()=>Z(s),className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-3",children:(f=s.item)!=null&&f.images&&s.item.images.length>0?e.jsx("img",{src:s.item.images[0].image_path,alt:s.item.name,className:"w-16 h-16 object-cover rounded"}):e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded flex items-center justify-center",children:e.jsx(M,{className:"text-gray-400 text-2xl"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.item.name}),e.jsx("div",{className:"text-gray-500 text-sm",children:((A=s.item.category)==null?void 0:A.name)||a("No Category")}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsxs("span",{className:"text-primary-600 font-bold",children:["ETB ",isNaN(i)?"0.00":i.toFixed(2)]}),e.jsxs("span",{className:"text-gray-500 text-sm",children:[a("Stock"),": ",s.quantity]})]})]})]})},s.id)})})},re=[{title:a("ID"),dataIndex:"id",key:"id",render:t=>e.jsxs("span",{children:["#",t]})},{title:a("Date"),dataIndex:"created_at",key:"created_at",render:t=>pe(t).format("YYYY-MM-DD HH:mm")},{title:a("Customer"),dataIndex:"customer",key:"customer",render:t=>t?t.name:a("Walk-in Customer")},{title:a("Shop"),dataIndex:"shop",key:"shop",render:t=>t?t.name:"-"},{title:a("Total"),dataIndex:"total",key:"total",render:t=>`ETB ${parseFloat(t).toFixed(2)}`},{title:a("Paid"),dataIndex:"paid",key:"paid",render:t=>`ETB ${parseFloat(t).toFixed(2)}`},{title:a("Credit"),dataIndex:"credit",key:"credit",render:(t,s)=>e.jsx("span",{children:parseFloat(t)>0?e.jsxs(we,{type:"danger",children:["ETB ",parseFloat(t).toFixed(2)]}):`ETB ${parseFloat(t).toFixed(2)}`})},{title:a("Status"),dataIndex:"payment_status",key:"payment_status",render:t=>getStatusTag(t)},{title:a("Actions"),key:"actions",render:(t,s)=>e.jsxs(ce,{children:[e.jsx(ne,{href:route("sales.show",s.id),children:e.jsx(c,{size:"small",icon:e.jsx(D,{})})}),parseFloat(s.credit)>0&&e.jsx(c,{size:"small",type:"primary",icon:e.jsx(ue,{}),onClick:i=>G(i,s)})]})}];return e.jsxs(me,{user:N.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:a("Sales")}),children:[e.jsx(de,{title:a("Sales")}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-primary-500",children:a("Sales Management")}),e.jsx(c,{type:"primary",icon:e.jsx(he,{}),onClick:U,children:a("New Sale")})]}),e.jsx(je,{columns:re,dataSource:u,rowKey:"id",pagination:{pageSize:10}})]})})}),e.jsx(z,{title:a("Record Credit Payment"),open:V,onCancel:()=>y(!1),footer:[e.jsx(c,{onClick:()=>y(!1),children:a("Cancel")},"cancel"),e.jsx(c,{type:"primary",onClick:J,loading:o.processing,children:a("Record Payment")},"submit")],children:p&&e.jsxs(m,{layout:"vertical",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:[a("Sale Reference"),": #",p.id]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a("Original Amount"),": ETB ",p.total.toFixed(2)]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a("Paid Amount"),": ETB ",p.paid.toFixed(2)]}),e.jsxs("div",{className:"font-semibold",children:[a("Remaining Credit"),": ETB ",p.credit.toFixed(2)]})]}),e.jsx(m.Item,{label:a("Amount Paid"),validateStatus:o.errors.credit_payed?"error":"",help:o.errors.credit_payed,required:!0,children:e.jsx(I,{style:{width:"100%"},value:o.data.credit_payed,onChange:t=>o.setData("credit_payed",t),min:.01,max:p.credit,formatter:t=>`ETB ${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/ETB\s?|(,*)/g,""),placeholder:a("Enter amount paid")})}),e.jsx(m.Item,{label:a("Note"),validateStatus:o.errors.note?"error":"",help:o.errors.note,children:e.jsx(T.TextArea,{value:o.data.note,onChange:t=>o.setData("note",t.target.value),rows:3,placeholder:a("Add optional note")})})]})}),e.jsx(z,{title:a("Create New Sale"),open:H,onCancel:()=>v(!1),footer:null,width:1e3,children:e.jsx(O,{defaultActiveKey:"items",children:e.jsx(_e,{tab:a("Items"),children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(C,{title:a("Select Items"),children:e.jsxs(e.Fragment,{children:[e.jsx(m.Item,{label:a("Shop"),required:!0,className:"mb-4",children:e.jsx(E,{placeholder:a("Select a shop"),style:{width:"100%"},value:g,onChange:X,children:h.map(t=>e.jsx(P,{value:t.id,children:t.name},t.id))})}),e.jsx(T,{prefix:e.jsx(D,{}),placeholder:a("Search items..."),value:q,onChange:t=>W(t.target.value),className:"mb-4"}),se()]})})}),e.jsxs("div",{children:[e.jsx(C,{title:a("Shopping Cart"),children:n.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400 flex flex-col items-center",children:[e.jsx(M,{style:{fontSize:"24px"}}),e.jsx("p",{children:a("Your cart is empty")}),e.jsx("p",{className:"text-xs",children:a("Select a shop and add items to your cart")})]}):e.jsxs(e.Fragment,{children:[n.map((t,s)=>e.jsxs("div",{className:"flex justify-between items-center py-2 border-b last:border-b-0",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsxs("div",{className:"text-gray-500 text-sm",children:["ETB ",parseFloat(t.price).toFixed(2)," ×",e.jsx(I,{min:1,max:t.max_quantity,value:t.quantity,onChange:i=>ee(s,i),size:"small",className:"ml-1 w-16"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-right",children:["ETB ",(parseFloat(t.price)*t.quantity).toFixed(2)]}),e.jsx(c,{type:"text",danger:!0,size:"small",onClick:()=>te(s),icon:e.jsx(Ce,{})})]})]},s)),e.jsx(ge,{}),e.jsxs("div",{className:"font-bold text-lg flex justify-between",children:[e.jsxs("span",{children:[a("Total"),":"]}),e.jsxs("span",{children:["ETB ",w.toFixed(2)]})]})]})}),e.jsx(C,{title:a("Payment Details"),className:"mt-4",children:e.jsxs(m,{layout:"vertical",children:[e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsx(m.Item,{label:a("Customer"),validateStatus:r.errors.customer_id?"error":"",help:r.errors.customer_id,children:e.jsx(E,{placeholder:a("Select a customer (optional)"),style:{width:"100%"},value:r.data.customer_id,onChange:t=>r.setData("customer_id",t),allowClear:!0,children:Y.map(t=>e.jsx(P,{value:t.id,children:t.name},t.id))})})}),e.jsx(m.Item,{label:a("Amount Paid"),validateStatus:r.errors.amount_paid?"error":"",help:r.errors.amount_paid,required:!0,children:e.jsx(I,{style:{width:"100%"},value:r.data.amount_paid,onChange:t=>r.setData("amount_paid",t),min:0,max:w,step:.01,formatter:t=>`ETB ${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:t=>t.replace(/ETB\s?|(,*)/g,"")})}),S>0&&e.jsx(fe,{message:a("Credit Sale"),description:e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[a("Customer will owe a balance of")," ",e.jsxs("strong",{children:["ETB ",S.toFixed(2)]})]}),!r.data.customer_id&&e.jsx("p",{className:"text-red-500",children:a("You must select a customer for credit sales")})]}),type:"warning",showIcon:!0,className:"mb-4"}),e.jsx(m.Item,{label:a("Note"),validateStatus:r.errors.note?"error":"",help:r.errors.note,children:e.jsx(T.TextArea,{value:r.data.note,onChange:t=>r.setData("note",t.target.value),rows:3,placeholder:a("Optional note about this sale")})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx(c,{onClick:()=>v(!1),children:a("Cancel")}),e.jsx(c,{type:"primary",onClick:ae,loading:r.processing,disabled:S>0&&!r.data.customer_id||n.length===0,children:a("Complete Sale")})]})]})})]})]})},"items")})})]})};export{nt as default};
